<html>
    <head>
        <title>Homework</title>
        
        <!--CSS-->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
        <link rel="stylesheet" href="/static/css/navigation.css">
        <link rel="stylesheet" href="/static/css/main.css">

        <!--Javascript-->
        <script src="https://code.jquery.com/jquery-3.3.1.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script>
        <script src="/static/js/moment.js"></script>
    </head>
    <script>
    
    </script>
    <body>
        <%- include header.ejs %>
        <p><strong><%- message %></strong></p>
        <h1 class="maintitle" >Duework</h1>
        <table style="border: 1px solid black; border-collapse: collapse; width:100%" id="dueworkTable">
            <tr>
                <th>Complete</th>
                <th>Subject Name</th>
                <th>Duework Label</th>
                <th>Due Date</th>
                <th>Delete</th>
            </tr>
            <% for(var i = 0; i < data.length; i++) { %> 
            <tr>
                <td><input type="checkbox" id="<%= i %>check" onchange="tickDuework(<%= data[i].id %>, this)"></td>
                <script>
                document.getElementById('<%= i %>check').checked = <%= data[i].complete %>;
                </script>
                <td><%= subjectdata[data[i].id].subjectname %></td>
                <td><%= data[i].worklabel %></td>
                <td id='<%= i %>'></td>
                <td><a href="#" onclick="removeDueWork(<%= data[i].id %>, this)">Delete</a></td>
                <script>
                var time = moment('<%= data[i].duedate %>').format("DD dddd, MMMM, YYYY");
                document.getElementById('<%= i %>').innerHTML = time;
                </script>
                <script>
                    function tickDuework(id, cb) {
                        console.log("Checkbox ID: " + id + ". Checkbox Value: " + cb.checked);
                        xmlhttp = new XMLHttpRequest();

                        xmlhttp.open("GET","/ajax/duework/change?id=" + id + "&value=" + cb.checked, true);
                        xmlhttp.send();
                     
                        console.log(xmlhttp.responseText);
                    }

                    function removeDueWork(id, row) {
                        console.log("Remove DueWork: " + id);

                        xmlhttp = new XMLHttpRequest();

                        xmlhttp.open("GET","/ajax/duework/remove?id=" + id, true);
                        xmlhttp.send();
                     
                        console.log(xmlhttp.responseText);

                        //Delete Row
                        var i = row.parentNode.parentNode.rowIndex;
                        document.getElementById("dueworkTable").deleteRow(i);
                    }
                </script>
            </tr>
            <% } %>
        </table>

        <a href="/app/duework/create">Create a new DueWork</a>

    </body>
</html>